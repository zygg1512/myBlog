# MCP JSON-RPC 消息

## 初始化

| 方法                        | 方向             | 触发方式                        | 能力要求 | 描述                                                 |
| :-------------------------- | :--------------- | :------------------------------ | :------- | :--------------------------------------------------- |
| `initialize`                | `client->server` | `Client.connect()`自动触发      | 无       | 客户端连接到服务器时发送的初始化请求                 |
| `ping`                      | 双向             | `Client.ping()`/`Server.ping()` | 无       | 客户端或服务器发送的 ping 请求，用于检测对端是否存活 |
| `notifications/initialized` | `client->server` | 初始化完成后自动触发            | 无       | 客户端在初始化完成后发送给服务器的通知               |

## 资源管理

| 方法                       | 方向             | 触发方式                         | 能力要求                     | 描述                         |
| :------------------------- | :--------------- | :------------------------------- | :--------------------------- | :--------------------------- |
| `resources/list`           | `client->server` | `Client.listResources()`         | `server.resources`           | 客户端请求服务器资源列表     |
| `resources/templates/list` | `client->server` | `Client.listResourceTemplates()` | `server.resources`           | 客户端请求服务器资源模板列表 |
| `resources/read`           | `client->server` | `Client.readResource()`          | `server.resources`           | 客户端读取特定资源 `URI`     |
| `resources/subscribe`      | `client->server` | `Client.subscribeResource()`     | `server.resources.subscribe` | 客户端订阅资源更新通知       |
| `resources/unsubscribe`    | `client->server` | `Client.unsubscribeResource()`   | `server.resources`           | 客户端取消资源更新订阅       |

## 工具系统

| 方法         | 方向             | 触发方式             | 能力要求       | 描述                       |
| :----------- | :--------------- | :------------------- | :------------- | :------------------------- |
| `tools/list` | `client->server` | `Client.listTools()` | `server.tools` | 客户端请求服务器工具列表   |
| `tools/call` | `client->server` | `Client.callTool()`  | `server.tools` | 客户端调用服务器提供的工具 |

## 提示系统

| 方法           | 方向             | 触发方式               | 能力要求         | 描述                       |
| :------------- | :--------------- | :--------------------- | :--------------- | :------------------------- |
| `prompts/list` | `client->server` | `Client.listPrompts()` | `server.prompts` | 客户端请求服务器提示列表   |
| `prompts/get`  | `client->server` | `Client.getPrompt()`   | `server.prompts` | 客户端获取服务器提供的提示 |

## 日志管理

| 方法               | 方向             | 触发方式                   | 能力要求         | 描述                     |
| :----------------- | :--------------- | :------------------------- | :--------------- | :----------------------- |
| `logging/setLevel` | `client->server` | `Client.setLoggingLevel()` | `server.logging` | 客户端调整服务器日志级别 |

## 自动完成

| 方法                  | 方向             | 触发方式            | 能力要求             | 描述                   |
| :-------------------- | :--------------- | :------------------ | :------------------- | :--------------------- |
| `completion/complete` | `client->server` | `Client.complete()` | `server.completions` | 客户端请求自动完成选项 |

## 采样（LLM 调用）

| 方法                     | 方向             | 触发方式                 | 能力要求          | 描述                          |
| :----------------------- | :--------------- | :----------------------- | :---------------- | :---------------------------- |
| `sampling/createMessage` | `server->client` | `Server.createMessage()` | `client.sampling` | 服务器通过客户端请求 LLM 采样 |

## 用户引导

| 方法                 | 方向             | 触发方式               | 能力要求             | 描述                         |
| :------------------- | :--------------- | :--------------------- | :------------------- | :--------------------------- |
| `elicitation/create` | `server->client` | `Server.elicitInput()` | `client.elicitation` | 服务器通过客户端引导用户输入 |

## 根目录管理

| 方法         | 方向             | 触发方式             | 能力要求       | 描述                              |
| :----------- | :--------------- | :------------------- | :------------- | :-------------------------------- |
| `roots/list` | `server->client` | `Server.listRoots()` | `client.roots` | 服务器请求客户端的根目录 URI 列表 |

## 任务系统

| 方法           | 方向 | 触发方式                                                                                | 能力要求    | 描述               |
| :------------- | :--- | :-------------------------------------------------------------------------------------- | :---------- | :----------------- |
| `tasks/get`    | 双向 | `client.experimental.tasks.getTask()`/`server.experimental.tasks.getTask()`             | 对方`tasks` | 获取特定任务的状态 |
| `tasks/result` | 双向 | `client.experimental.tasks.getTaskResult()`/`server.experimental.tasks.getTaskResult()` | 对方`tasks` | 获取特定任务的结果 |
| `tasks/list`   | 双向 | `client.experimental.tasks.listTasks()`/`server.experimental.tasks.listTasks()`         | 对方`tasks` | 列出任务           |
| `tasks/cancel` | 双向 | `client.experimental.tasks.cancelTask()`/`server.experimental.tasks.cancelTask()`       | 对方`tasks` | 取消特定任务       |

## 通知系统

### 双向通知

| 方法                         | 方向             | 触发方式                                                         | 能力要求    | 描述                                   |
| :--------------------------- | :--------------- | :--------------------------------------------------------------- | :---------- | :------------------------------------- |
| `notifications/cancelled`    | 双向             | 请求取消时自动触发                                               | 无          | 取消先前发出的请求                     |
| `notifications/progress`     | 双向             | 开发者需要在处理长时间运行操作时手动调用`extra.sendNotification` | 无          | 长运行请求的进度更新通知               |
| `notifications/tasks/status` | 双向             | 任务状态变化                                                     | 对方`tasks` | 任务状态变更通知                       |
| `notifications/initialized`  | `client->server` | 初始化完成后自动触发                                             | 无          | 客户端在初始化完成后发送给服务器的通知 |

### 客户端发起的通知

| 方法                               | 方向             | 触发方式                        | 能力要求                   | 描述                     |
| :--------------------------------- | :--------------- | :------------------------------ | :------------------------- | :----------------------- |
| `notifications/roots/list_changed` | `client->server` | `Client.sendRootsListChanged()` | `client.roots.listChanged` | 客户端根目录列表变更通知 |

### 服务器发起的通知

| 方法                                   | 方向             | 触发方式                           | 能力要求                       | 描述                             |
| :------------------------------------- | :--------------- | :--------------------------------- | :----------------------------- | :------------------------------- |
| `notifications/message`                | `server->client` | `Server.sendLoggingMessage()`      | `server.logging`               | 服务器传递给客户端的日志消息通知 |
| `notifications/resources/updated`      | `server->client` | `Server.sendResourceUpdated()`     | `server.resources`             | 资源更新通知（需先订阅）         |
| `notifications/resources/list_changed` | `server->client` | `Server.sendResourceListChanged()` | `server.resources.listChanged` | 服务器资源列表变更通知           |
| `notifications/tools/list_changed`     | `server->client` | `Server.sendToolListChanged()`     | `server.tools.listChanged`     | 服务器工具列表变更通知           |
| `notifications/prompts/list_changed`   | `server->client` | `Server.sendPromptListChanged()`   | `server.prompts.listChanged`   | 服务器提示列表变更通知           |
| `notifications/elicitation/complete`   | `server->client` | 创建的通知器被调用                 | `client.elicitation.url`       | 服务器引导完成通知               |
