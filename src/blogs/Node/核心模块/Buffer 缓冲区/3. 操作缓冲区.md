# 读写缓冲区
### 写入缓冲区
#### 方式一：单个元素赋值
Buffer 类似于数组，可以直接赋值，默认是10进制，0x表示16进制，也可以是2进制
```javascript
const buf = Buffer.alloc(3)
buf[0] = 89
buf[1] = 11111101
buf[3] = 0xaa
```
Buffer 对象可以存储不同编码类型的字符串转码的值，调用`write`方法可以实现
#### 方式二：write 方法
`buf.write(string[, offset[, length]][, encoding])`<br />返回实际写入的大小。如果 Buffer 空间不足， 则只写入部分字符串，并从头开始替换旧值<br />参数描述如下：

- string - 写入缓冲区的字符串
- offset - 缓冲区开始写入的索引值，默认为 0 
- length - 写入的字节数，默认为`buffer.length`
- encoding - 使用的编码。默认为 'utf8' 
```javascript
const buf = Buffer.alloc(256)
const len = buf.write("xxx")
console.log("写入字节数："+  len) // 写入字节数：3

// 如果 buffer 空间不足， 则只写入部分字符串，并从头开始替换旧值
const buf3 = Buffer.from('abc')
buf3.write("de")
console.log(buf3.toString()) // dec
```
### 读取缓冲区
#### 方式一：读取某个元素
直接打印Buffer显示的是两位的16进制，打印某一个元素显示的是10进制。可通过 **buf[x].toString(进制) **的方式打印其他进制
```javascript
const buf = Buffer.alloc(1)
buf[0] = 0xaa

console.log(buf[0]) // 170
console.log(buf[0].toString(10))  // '170'
console.log(buf[0].toString(16)) // 'aa'
```
如果需要将其转换成其他编码方式可通过 toString 方法
#### 方式二：toString 方法
`buf.toString([encoding[,start[,end]]])`解码缓冲区数据并使用指定的编码返回字符串<br />参数描述如下：

- encoding - 使用的编码。默认为 'utf8' 
- start - 指定开始读取的索引位置，默认为 0
- end - 结束位置，默认为缓冲区的末尾
```javascript
const buf = Buffer.alloc(26)
for (let i = 0; i < 26; i++) {
  buf[i] = i + 97
}
 
console.log(buf.toString('ascii'))     // 输出: abcdefghijklmnopqrstuvwxyz
console.log(buf.toString('ascii', 0, 5))  // 输出: abcde
console.log(buf.toString('utf8', 0, 5))    // 输出: abcde
console.log(buf.toString(undefined, 0, 5)) // 使用 'utf8' 编码, 并输出: abcde
```
#### Buffer 和 string 转换
`Buffer.from(string [, encoding])` 字符串转为 Buffer
```javascript
const buf1 = Buffer.from('test', 'utf-8') // <Buffer 74 65 73 74>
```
`buf.toString([encoding[, start[, end]]])`  Buffer 实例的 toString 方法可以将 Buffer 转为字符串
```javascript
const buf1 = Buffer.from('test', 'utf-8')
console.log(buf1.toString()) // test
console.log(buf1.toString('hex')) // 74657374
```
#### Buffer 转 JSON
```javascript
var buf = Buffer.from('xxx')
var json = buf.toJSON(buf)
 
console.log(json)
// { type: 'Buffer', data: [ 120, 120, 120 ] }
```
# 直接赋值和读取缓冲区
```javascript

console.log(buf) // <Buffer c7 bd>
console.log(buf[0]) // 199
console.log(buf[1]) // 189
```
# 缓冲区合并
`Buffer.concat(list[, totalLength])`返回一个将多个 Buffer 实例合并后的**新 Buffer 实例**<br />参数描述如下：

- list - 用于合并的 Buffer 对象数组列表
- totalLength - 指定合并后 Buffer 对象的总长度
```javascript
const buf1 = Buffer.from('a')
const buf2 = Buffer.from('b')
const buf3 = Buffer.from('c')

const buf = Buffer.concat([buf1, buf2, buf3])
console.log(buf) // <Buffer 61 62 63>
```
# 缓冲区比较
`buf.compare(otherBuffer)`返回一个数字，表示 buf 在 otherBuffer 之前、之后或相同<br />参数描述如下：

- otherBuffer - 与 buf 对象比较的另外一个 Buffer 对象
```javascript
const buffer1 = Buffer.from('ABC')
const buffer2 =Buffer.from('ABCD')
const result = buffer1.compare(buffer2)
 
if(result < 0) {
   console.log(buffer1 + " 在 " + buffer2 + "之前")
}else if(result == 0){
   console.log(buffer1 + " 与 " + buffer2 + "相同")
}else {
   console.log(buffer1 + " 在 " + buffer2 + "之后")
}
// 输出 ABC 在 ABCD 之前
```
# 拷贝缓冲区
`source.copy(target[, targetStart[, sourceStart[, sourceEnd]]])`<br />将 source （部分）内容**深拷贝**给 target，没有返回值<br />参数描述如下：

- targetBuffer - 要拷贝的 Buffer 对象
- targetStart - 数字, 可选, 默认: 0
- sourceStart - 数字, 可选, 默认: 0
- sourceEnd - 数字, 可选, 默认: buffer.length
```javascript
const buffer1 = Buffer.from('ABC')
// 拷贝一个缓冲区
const buffer2 = Buffer.alloc(3)
buffer1.copy(buffer2)
console.log(buffer1.toString()) // ABC
console.log(buffer2.toString()) // ABC
```
# 缓冲区裁剪
`buf.slice([start[, end]])`，返回一个新的缓冲区，**它和旧缓冲区指向同一块内存**，但是从索引 start 到 end 的位置剪切
```javascript
const buffer1 = Buffer.from('ABCD')
// 剪切缓冲区
const buffer2 = buffer1.slice(0, 2)
console.log(buffer2.toString()) // AB
```
# 缓冲区长度
`buf.length`返回 Buffer 中**所占据的内存长度**
```javascript
var buffer = Buffer.from('ABCD')
//  缓冲区长度
console.log(buffer.length) // 4
```
