# 文件命令

## 操作文件属性

Linux 系统是一种典型的多用户系统，不同的用户拥有不同的权限。

为了保护系统的安全性，Linux系统对不同的用户访问同一文件（包括目录）的权限做了不同的规定
在Linux中我们可以使用`ll`或者`ls –l`命令来显示一个文件的属性以及文件所属的用户和组，如：

```bash
> ls -l
-rw-r--r--  1 xxx  		staff  95     5  3 13:17 					hello-world.sh
drwxr-xr-x  2 xxx  		staff  64     5  3 16:36 					test
## 解释
权限相关			 属主			属组	  大小   时间(月 日 小时:分钟)  文件名
drwxr-xr-x  2 xxx  		staff  64     5  3 16:36 					test
lrwxr-xr-x  3 xxx  		staff  96     5  3 16:25 					bin -> usr/bin
```

### 权限相关

<img height="300px" src="https://github.com/zygg1512/myBlog/raw/master/assets/linux/文件权限.png" />

在Linux中第一个字符代表这个文件是目录、文件或链接文件等等：

*   **当为\[ d ]则是目录**

*   **当为\[ - ]则是文件**

*   **若是\[ l ]则表示为软链接文档 ( link file )，会说明这个链接指向的文件**

*   若是\[ **b** ]则表示为块设备，如硬盘

*   若是\[ **c** ]则表示为是字符设备文件，如鼠标，键盘

接下来的字符中，以三个为一组，且均为『rwx』组合。其中：

*   \[ r ]代表可读(read)

*   \[ w ]代表可写(write)

*   \[ x ]代表可执行(execute)

要注意的是，这三个权限的位置不会改变，如果没有权限，就会出现减号\[ - ]而已

### 权限属组

Linux系统按文件所有者、文件所有者同组用户和其他用户来规定了不同的文件访问权限

*   **属主（Owner）**：对于文件来说，它都有一个特定的所有者，也就是对该文件具有所有权的用户

*   **属组（Group）**：在Linux系统中，用户是按组分类的，一个用户属于一个或多个组

*   **其他用户（Others）**：文件所有者以外的用户又可以分为文件所有者的同组用户和其他用户

### chgrp更改文件属组

```bash
chgrp [-R] 属组名 文件名

-R：递归更改文件属组
    就是在更改某个目录文件的属组时，如果加上-R的参数，那么该目录下的所有文件的属组都会更改
```

### chown更改文件属主，也可以同时更改文件属组

```bash
chown [–R] 属主名 文件名
chown [-R] 属主名：属组名 文件名
```

### chmod：更改文件权限

权限除了用 r w x 这种方式表示，也可以用数字表示，数字与字母的对应关系为：

*   r: 4

*   w: 2

*   x: 1

之所有如此对应关系，主要还是为了方便推导，比如

*   希望一个文件可读可写，那可以方便的设置权限为 6（4 + 2）

*   如果知道一个权限为 3，也可以推导出权限为可写可执行，因为只有 2 + 1 才可能等于 3

```bash
## -R：递归更改文件属组
chmod [-R] xyz 文件或目录
```

其中 xyz 分别表示 Owner、Group、Others 的权限，如果这样设置一个文件的权限：

```bash
chmod 750 index.html
```

可以得知，对应字母为：rwxr-x---

*   Owner 的权限为 7，为可读可写可执行

*   Group 的权限为 5，为可读可执行

*   Others 的权限为 0，表示不可读写不可执行

```bash
## 对应字母为：rwxrwxrwx
chmod 777 index.html
```

除了这种数字的方式，还有一种使用符号类型改变权限的方式：

在这种方式里，我们将三种身份 Owner、Group、Others，分别简写为 u（User）、g、o，用 a 表示所有身份，再使用`+-=`表示加入、去除、设定一个权限，rwx 则继续表示读，写，执行权限，举个例子：

```bash
## Owner 加上执行权限，Group 和 Others 去除执行权限
chmod u+x,g-x,o-x index.html

## 此时文件的权限就相当于 -rwxr-xr--
chmod u=rwx,g=rx,o=r index.html

## 还可以省略不写 ugoa 这类身份内容，相当于使用了a，会给所有身份添加执行权限
chmod +x index.html
```

### ln 创建文件链接

```bash
## 使用 touch 创建文件
> touch f1
## 创建硬链接 f2
> ln f1 f2
## 创建软链接（符号链接）f3
> ln -s f1 f3

## 给目录创建软链接
> ln -s 绝对路径1 绝对路径2 ## 在绝对路径2中创建软链接文件夹

## 可选项
-v ## 显示处理过程
```

## 查看文件内容

### cat 由第一行开始显示文件内容

```bash
> cat index.html

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    
</body>
</html>          
```

### nl 由第一行开始显示文件内容并输出行号

```bash
> nl index.html

1	<!DOCTYPE html>
2	<html lang="en">
3	<head>
4	    <meta charset="UTF-8">
5	    <meta http-equiv="X-UA-Compatible" content="IE=edge">
6	    <meta name="viewport" content="width=device-width, initial-scale=1.0">
7	    <title>Document</title>
8	</head>
9	<body>
10	    
11	</body>
12	</html>
```

### more 一页一页的显示文件内容

```bash
> more index.html

<!DOCTYPE html>
<html lang="en">
<head>
:
## 显示第一页并进入底线命令模式

## 参数
-f：显示行号
```

*   **空格键翻到下一页**，如果是最后一页会退出底线命令模式
*   **回车、下箭头一行一行显示**；翻到最后一行会显示 (END)，继续按下箭头会退出底线命令模式，并保留输出

### less一页一页的显示文件内容

```bash
> less index.html

<!DOCTYPE html>
<html lang="en">
<head>
:
```

*   和 more 命令类似，但是比 more 命令更好的是可以往前翻页
*   **不会保留输出**，也就是说退出后控制台不会显示文件内容

```bash
> less index.html
>
```

操作键：

*   **空格键翻到下一页**，如果是最后一页**不会**退出底线命令模式
*   **回车、下箭头一行一行显示**；翻到最后一行会显示 (END)，继续按下箭头不会退出，可以继续上箭头查看；可以按 q 退出
*   **字符串查找，在命令模式中输入**
    *   `/xxx`向下查找`xxx`
    *   `?xxx`向上查找`xxx`
    *   键盘`n`下一个
    *   键盘`N`上一个

### head 只看头几行

```bash
## 只查看前 20 行
> head -n 20 index.html
```

### tail 只看尾几行

```bash
## 只查看前 20 行
> tail -n 20 index.html
```

## Vim 编辑器

```bash
## 如果文件存在就修改这个文件，如果不存在则创建这个文件
> vim 文件名
```

### 三种使用模式
<img height="300px" src="https://github.com/zygg1512/myBlog/raw/master/assets/linux/vim工作模式.png" />

基本上 vi/vim 共分为三种模式，分别是
- **命令模式（Command mode）**
- **输入模式（Insert mode）**
- **底线命令模式（Last line mode）**
#### 命令模式

用户刚刚启动 vi/vim，便进入了命令模式
此状态下敲击键盘动作会被Vim识别为命令，而非输入字符。比如我们此时按下`i`，并不会输入一个字符，`i`被当作了一个命令
以下是常用的几个命令：
*   `i`切换到输入模式，以输入字符
*   `x`删除当前光标所在处的字符
*   `:`切换到底线命令模式，可以在最底一行输入命令

命令模式只有一些最基本的命令，因此仍要依靠底线命令模式输入更多命令。
#### 输入模式
在命令模式下按下`i`就进入了输入模式
在输入模式中，可以使用以下按键：
*   Insert，切换光标为输入/替换模式，光标将变成竖线/下划线
*   ESC，退出输入模式，切换到命令模式

#### 底线命令模式
在命令模式下按下`:`(英文冒号)就进入了底线命令模式，基本的命令有（已经省略了冒号）：
*   `q`退出程序
*   `w`保存文件
*   按ESC键可随时退出底线命令模式

### Vim 按键说明

除了上面简易范例的`i`、`Esc`、`:wq`之外，其实 vim 还有非常多的按键可以使用。

**第一部分：命令模式可用的光标移动、复制粘贴、搜索替换等**

| 移动光标的方法          |                                                          |
| ---------------- | -------------------------------------------------------- |
| \[Ctrl] + \[f]   | 屏幕『向下』移动一页，相当于 \[Page Down]按键                            |
| \[Ctrl] + \[b]   | 屏幕『向上』移动一页，相当于 \[Page Up] 按键                             |
| \[Ctrl] + \[d]   | 屏幕『向下』移动半页                                               |
| \[Ctrl] + \[u]   | 屏幕『向上』移动半页                                               |
| shift +          | 光标移动到非空格符的下一行                                            |
| -                | 光标移动到非空格符的上一行                                            |
| n< space\>       | 那个 n 表示『数字』，例如 20 。按下数字后再按空格键，光标会向右移动这一行的 n 个字符          |
| 0                | 这是数字『 0 』：移动到这一行的最前面                                     |
| \$(shift 4)      | 移动到这一行的最后面                                               |
| H(shift h)       | 光标移动到这个屏幕的最上方那一行的第一个字符                                   |
| shift M(shift m) | 光标移动到这个屏幕的中央那一行的第一个字符                                    |
| shift L(shift l) | 光标移动到这个屏幕的最下方那一行的第一个字符                                   |
| G(shift g)       | 移动到这个档案的最后一行                                             |
| nG               | n 为数字。移动到这个档案的第 n 行。例如 20G 则会移动到这个档案的第 20 行(可配合 :set nu) |
| gg               | 移动到这个档案的第一行                                              |
| n< Enter\>       | n 为数字。光标向下移动 n 行                                         |

| 删除、复制与粘贴  |                                                                                                                                                  |
| --------- | ------------------------------------------------------------------------------------------------------------------------------------------------ |
| x, X      | 在一行字当中，x 为向后删除一个字符 (相当于 \[del] 按键)， X 为向前删除一个字符(相当于 \[backspace] 亦即是退格键) (常用)                                                                    |
| nx        | n 为数字，连续向后删除 n 个字符。举例来说，我要连续删除 10 个字符， 『10x』。                                                                                                    |
| dd        | 删除游标所在的那一整行                                                                                                                                      |
| ndd       | n 为数字。删除光标所在的向下 n 行，例如 20dd 则是删除 20 行                                                                                                            |
| d1G       | 删除光标所在到第一行的所有数据                                                                                                                                  |
| dG        | 删除光标所在到最后一行的所有数据                                                                                                                                 |
| d\$       | 删除游标所在处，到该行的最后一个字符                                                                                                                               |
| d0        | 那个是数字的 0 ，删除游标所在处，到该行的最前面一个字符                                                                                                                    |
| yy        | 复制光标标所在的那一行                                                                                                                                      |
| nyy       | n 为数字。复制光标所在的向下 n 行，例如 20yy 则是复制 20 行                                                                                                            |
| y1G       | 复制游标所在行到第一行的所有数据                                                                                                                                 |
| yG        | 复制游标所在行到最后一行的所有数据                                                                                                                                |
| y0        | 复制光标所在的那个字符到该行行首的所有数据                                                                                                                            |
| y\$       | 复制光标所在的那个字符到该行行尾的所有数据                                                                                                                            |
| p, P      | p 为将已复制的数据在光标下一行贴上，P 则为贴在游标上一行！举例来说，我目前光标在第 20 行，且已经复制了 10 行数据。则按下 p 后， 那 10 行数据会贴在原本的 20 行之后，亦即由 21 行开始贴。但如果是按下 P 呢？那么原本的第 20 行会被推到变成 30 行。(常用) |
| J         | 将光标所在行与下一行的数据结合成同一行                                                                                                                              |
| c         | 重复删除多个数据，例如向下删除 10 行，\[ 10cj ]                                                                                                                   |
| u         | 复原前一个动作                                                                                                                                          |
| \[Ctrl]+r | 重做上一个动作                                                                                                                                          |

| 搜索替换  |                                                                                                                                                |
| ----- | ---------------------------------------------------------------------------------------------------------------------------------------------- |
| /word | 向光标之下寻找一个名称为 word 的字符串。例如要在档案内搜寻 vbird 这个字符串，就输入 /vbird 即可                                                                                     |
| ?word | 向光标之上寻找一个字符串名称为 word 的字符串。                                                                                                                     |
| n     | 这个 n 是英文按键。代表重复前一个搜寻的动作。举例来说， 如果刚刚我们执行 /vbird 去向下搜寻 vbird 这个字符串，则按下 n 后，会向下继续搜寻下一个名称为 vbird 的字符串。如果是执行 ?vbird 的话，那么按下 n 则会向上继续搜寻名称为 vbird 的字符串 |
| N     | 这个 N 是英文按键。与 n 刚好相反，为『反向』进行前一个搜寻动作。例如 /vbird 后，按下 N 则表示『向上』搜寻 vbird                                                                            |

**第二部分：命令模式切换到编辑模式的可用的按钮说明**

| i, I   | 进入输入模式(Insert mode)：i 为『从目前光标所在处输入』， I 为『在目前所在行的第一个非空格符处开始输入』                   |
| ------ | ------------------------------------------------------------------------------- |
| a, A   | 进入输入模式(Insert mode)：a 为『从目前光标所在的下一个字符处开始输入』， A 为『从光标所在行的最后一个字符处开始输入』            |
| o, O   | 进入输入模式(Insert mode)：这是英文字母 o 的大小写。o 为『在目前光标所在的下一行处输入新的一行』；O 为在目前光标所在处的上一行输入新的一行 |
| r, R   | 进入取代模式(Replace mode)：r 只会取代光标所在的那一个字符一次；R会一直取代光标所在的文字，直到按下 ESC 为止               |
| \[Esc] | 退出编辑模式，回到一般模式中                                                                  |

**第三部分：命令模式切换到底线命令模式的可用的按钮说明**

| 指令行的储存、离开等指令         |                                                                                 |
| -------------------- | ------------------------------------------------------------------------------- |
| :w                   | 将编辑的数据写入硬盘档案中(常用)                                                               |
| :w!                  | 若文件属性为『只读』时，强制写入该档案。不过，到底能不能写入， 还是跟你对该档案的档案权限有关啊！                               |
| :q                   | 离开 vi                                                                           |
| :q!                  | 若曾修改过档案，又不想储存，使用 ! 为强制离开不储存档案                                                   |
| :wq                  | 储存后离开，若为 :wq! 则为强制储存后离开                                                         |
| ZZ                   | 这是大写的 Z 喔！若档案没有更动，则不储存离开，若档案已经被更动过，则储存后离开                                       |
| :w \[filename]       | 将编辑的数据储存成另一个档案（类似另存新档）                                                          |
| :r \[filename]       | 在编辑的数据中，读入另一个档案的数据。亦即将 『filename』 这个档案内容加到游标所在行后面                               |
| :n1,n2 w \[filename] | 将 n1 到 n2 的内容储存成 filename 这个档案                                                  |
| :! command           | 暂时离开 vi 到指令行模式下执行 command 的显示结果！例如 『:! ls /home』即可在 vi 当中看 /home 底下以 ls 输出的档案信息 |
| :set nu              | 显示行号，设定之后，会在每一行的前缀显示该行的行号                                                       |
| :set nonu            | 取消行号                                                                            |
